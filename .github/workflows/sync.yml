name: ğŸ”„ Auto Sync - Cursor.ai â†” Lovable

on:
  push:
    branches: [ main ]
    paths-ignore:
      - 'README.md'
      - 'SYNC_GUIDE.md'
      - '.github/**'
  pull_request:
    branches: [ main ]

jobs:
  sync-check:
    runs-on: ubuntu-latest
    name: ğŸ” Verificar SincronizaciÃ³n
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
        
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ Instalar dependencias
        run: npm ci
        
      - name: ğŸ” Verificar sintaxis
        run: npm run lint
        
      - name: ğŸ—ï¸ Verificar build
        run: npm run build
        
      - name: âœ… Verificar archivos de sincronizaciÃ³n
        run: |
          echo "ğŸ” Verificando archivos de sincronizaciÃ³n..."
          
          # Verificar que existen los scripts
          if [ ! -f "scripts/sync.sh" ]; then
            echo "âŒ Error: scripts/sync.sh no encontrado"
            exit 1
          fi
          
          if [ ! -f "scripts/sync.ps1" ]; then
            echo "âŒ Error: scripts/sync.ps1 no encontrado"
            exit 1
          fi
          
          if [ ! -f "lovable.config.json" ]; then
            echo "âŒ Error: lovable.config.json no encontrado"
            exit 1
          fi
          
          if [ ! -f "SYNC_GUIDE.md" ]; then
            echo "âŒ Error: SYNC_GUIDE.md no encontrado"
            exit 1
          fi
          
          echo "âœ… Todos los archivos de sincronizaciÃ³n estÃ¡n presentes"
          
      - name: ğŸ“Š Mostrar informaciÃ³n del commit
        run: |
          echo "ğŸ“ Commit Info:"
          echo "Author: ${{ github.actor }}"
          echo "Message: ${{ github.event.head_commit.message }}"
          echo "Files changed:"
          git diff --name-only ${{ github.event.before }} ${{ github.event.after }} || echo "No files changed"
          
  notify-lovable:
    runs-on: ubuntu-latest
    name: ğŸ“¢ Notificar a Lovable
    needs: sync-check
    if: github.event_name == 'push'
    
    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4
        
      - name: ğŸ“¢ Notificar cambios
        run: |
          echo "ğŸš€ Cambios sincronizados exitosamente"
          echo "ğŸ“… Timestamp: $(date)"
          echo "ğŸ‘¤ Autor: ${{ github.actor }}"
          echo "ğŸ“ Mensaje: ${{ github.event.head_commit.message }}"
          echo "ğŸ”— Commit: ${{ github.event.head_commit.url }}"
          echo ""
          echo "Lovable detectarÃ¡ estos cambios automÃ¡ticamente"
          echo "y harÃ¡ deploy de la nueva versiÃ³n."
          
      - name: ğŸ“Š Resumen de cambios
        run: |
          echo "ğŸ“Š Resumen de cambios:"
          echo "======================"
          git diff --stat ${{ github.event.before }} ${{ github.event.after }} || echo "No hay cambios para mostrar" 